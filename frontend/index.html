<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Test Momo API</title>
  </head>
  <body>
    <h1>Effectuer une Transaction Mobile Money</h1>

    <label for="transactionType">Type de transaction :</label>
    <select id="transactionType" onchange="afficherChamps()">
      <option value="collection">📦 Collection (Recevoir)</option>
      <option value="disbursement">💸 Disbursement (Envoyer)</option>
      <option value="remittance">🌍 Remittance (International)</option>
    </select>
    <br /><br />

    <label for="expediteur">Numéro Expéditeur :</label>
    <input type="text" id="expediteur" placeholder="Ex: 256774290781" />
    <br /><br />

    <label for="recepteur">Numéro Récepteur :</label>
    <input type="text" id="recepteur" placeholder="Ex: 256774290782" />
    <br /><br />

    <div id="montantSection" style="display:none;">
      <label for="amount">Montant (optionnel) :</label>
      <input type="text" id="amount" placeholder="Ex: 2000" />
      <br /><br />

      <label for="currency">Devise (optionnel) :</label>
      <input type="text" id="currency" placeholder="Ex: EUR" />
      <br /><br />
    </div>

    <button onclick="lancerTransaction()">Lancer la transaction</button>

    <script>
      function afficherChamps() {
        const type = document.getElementById("transactionType").value;
        const montantSection = document.getElementById("montantSection");
        
        if (type === "disbursement" || type === "remittance") {
          montantSection.style.display = "block";
        } else {
          montantSection.style.display = "none";
        }
      }

      function lancerTransaction() {
        const type = document.getElementById("transactionType").value;
        const expediteur = document.getElementById("expediteur").value;
        const recepteur = document.getElementById("recepteur").value;
        const amount = document.getElementById("amount").value;
        const currency = document.getElementById("currency").value;

        if (!expediteur || !recepteur) {
          alert("🚨 Veuillez remplir les numéros expéditeur et récepteur !");
          return;
        }

        let endpoint = "";
        let payload = {
          numeroExpediteur: expediteur,
          numeroRecepteur: recepteur,
        };

        if (type === "collection") {
          endpoint = "collection";
        } else if (type === "disbursement" || type === "remittance") {
          if (!amount || !currency) {
            alert("🚨 Veuillez renseigner le montant et la devise !");
            return;
          }
          endpoint = type;
          payload.amount = amount;
          payload.currency = currency;
        }

        fetch(`http://localhost:3000/${endpoint}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("✅ Réponse du serveur:", data);
            alert(data.message || "Transaction réussie !");
          })
          .catch((error) => {
            console.error("❌ Erreur:", error);
            alert("Erreur durant la transaction");
          });
      }

      // Initialiser les champs visibles en fonction de la sélection par défaut
      afficherChamps();
    </script>
  </body>
</html>
